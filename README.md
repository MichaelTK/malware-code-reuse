# malware-code-reuse

Contents of repository:

* 50KC_flat.zip
- Archive containing a selection of the 50KC benign GitHub repository dataset. This archive contains
the full source code of the samples.

* 50KC_flat_zips.zip
- Archive containing the code from 50KC_flat.zip but with a nested archive for each repository - this
allows processing by the SourcererCC tool.

* 50KC_flat_with_cloned_postmethod_zips.zip
- Same as 50KC_flat_zips.zip, however this will be changed in the course of reproducing our work's results
as some code from the malicious repositories will be added to it.

* 50KC_flat_with_cloned_postmethod.tar.gz.a*
- Archive containing the full source code for each repository contained in

* 50KC_flat_with_cloned_postmethod_zips.zip.
SourcererCC-artifact.tar.gz.a*
- Archive containing a working installation of the SourcererCC tool.

* ufsf_java_repos_flat.tar.gz.a*
- Archive containing the full source code of the malicious GitHub repositories gathered for the paper. This
includes repositories scraped from Underground Forums and ones gathered from the SourceFinder work.

* ufsf_java_repos_flat_zips.tar.gz.a*
- Archive containing the code from ufsf_java_repos_flat.tar.gz.a* but with a nested archive for each repository.

* combined_repos_links.txt
- A list of the GitHub links to the malicious repositories used in this work.

* repo_and_timemins.pkl
- A dictionary containing the malicious repositories used and the minimum commit timestamp of each.

* repolinks_types_withmultilabel.pkl
- A dictionary contanining the links to the malicious repositories and their labeled type.

* uninteresting_library_list.txt
- A blacklist of benign/uninteresting API call prefixes. Refer to the paper for more information.

Numerous Python scripts required to reproduce the work.


Archives which end in .tar.gz.a* will need to be recombined in order to be extracted. This can be accomplished
as follows. For example, in order to extract ufsf_java_repos_flat.tar.gz.a*, run the following line of code:

    cat ufsf_java_repos_flat.tar.gz.* | tar xzvf -


Steps to reproduce work:

1. Unzip the following archives. If needed, combine the constituent sub-archives into these so they are able to be
extracted.
 
    cat ufsf_java_repos_flat.tar.gz.* | tar xzvf -
    cat ufsf_java_repos_flat_zips.tar.gz.* | tar xzvf -
    unzip 50KC_flat.zip
    unzip 50KC_flat_zips.zip
    cat 50KC_flat_with_cloned_postmethod_zips.tar.gz.* | tar xzvf -
    cat 50KC_flat_with_cloned_postmethod.tar.gz.* | tar xzvf - 


2. 
For 50KC_flat_zips (make sure the paths are set properly):
     python3 project_list_generator_fromzips.py
For ufsf_java_repos_flat/ufsf_java_repos/flat_zips:
     python3 project_list_generator_fromzips.py

3. Navigate to SourcererCC-artifact/tokenizers/block-level.
    cp projects-list-ufsf.txt projects-list.txt.
    ./run_sourc.sh

4. Navigate to SourcererCC-artifact.
    mv sourc_results sourc_results_ufsf

5. Navigate to SourcererCC-artifact/tokenizers/block-level.
    rm projects-list.txt
    cp projects-list-50kc.txt projects-list.txt
    ./run_sourc.sh

6. Navigate to SourcererCC-artifact.
    mv sourc_results sourc_results_50kc

7. 
    python3 networkx_generator_astgks_inject_benign_dataset.py

8. Navigate to 50KC_flat_with_cloned_postmethod_zips.
    zip -r astgks_clones.zip astgks_clones && rm -r astgks_clones

9. 
    python3 project_list_generator_fromzips.py for 50KC_flat_with_cloned_postmethod_zips.

10. Navigate to SourcererCC-artifact/tokenizers/block-level.
    rm projects-list.txt
    mv projects-list-hybrid.txt projects-list.txt
    ./run_sourc.sh

11. Navigate to SourcererCC-artifact.
    mv sourc_results sourc_results_hybrid

12. 
    python3 networkx_generator_astgks.py

This will create a .gexf file with a code reuse graph. The file is by default named
"projects_java40_filtered_50kcfiltered_directed.gexf" and it's stored in 
SourcererCC-artifact/sourc_results_hybrid.
