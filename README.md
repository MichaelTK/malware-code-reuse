# malware-code-reuse

Contents of repository:

* 50KC_flat.zip
Archive containing a selection of the 50KC benign GitHub repository dataset. This archive contains
the full source code of the samples.

* 50KC_flat_zips.zip
Archive containing the code from 50KC_flat.zip but with a nested archive for each repository - this
allows processing by the SourcererCC tool.

* 50KC_flat_with_cloned_postmethod_zips.zip
Same as 50KC_flat_zips.zip, however this will be changed in the course of reproducing our work's results
as some code from the malicious repositories will be added to it.

* 50KC_flat_with_cloned_postmethod.tar.gz.a*
Archive containing the full source code for each repository contained in

* 50KC_flat_with_cloned_postmethod_zips.zip.
SourcererCC-artifact.tar.gz.a*
Archive containing a working installation of the SourcererCC tool.

* ufsf_java_repos_flat.tar.gz.a*
Archive containing the full source code of the malicious GitHub repositories gathered for the paper. This
includes repositories scraped from Underground Forums and ones gathered from the SourceFinder work.

* ufsf_java_repos_flat_zips.tar.gz.a*
Archive containing the code from ufsf_java_repos_flat.tar.gz.a* but with a nested archive for each repository.

* combined_repos_links.txt
A list of the GitHub links to the malicious repositories used in this work.

* repo_and_timemins.pkl
A dictionary containing the malicious repositories used and the minimum commit timestamp of each.

* repolinks_types_withmultilabel.pkl
A dictionary contanining the links to the malicious repositories and their labeled type.

* uninteresting_library_list.txt
A blacklist of benign/uninteresting API call prefixes. Refer to the paper for more information.

Numerous Python scripts required to reproduce the work.


Archives which end in .tar.gz.a* will need to be recombined in order to be extracted. This can be accomplished
as follows. For example, in order to extract ufsf_java_repos_flat.tar.gz.a*, run the following line of code:

    cat ufsf_java_repos_flat.tar.gz.* | tar xzvf -

In all the scripts used to reproduce the work, all paths must end with a trailing "/".

Steps to reproduce work:

Unzip the following archives. If needed, combine the constituent sub-archives into these so they are able to be
extracted.
 
    cat ufsf_java_repos_flat.tar.gz.* | tar xzvf -
    unzip ufsf_java_repos_flat.zip
    cat ufsf_java_repos_flat_zips.tar.gz.* | tar xzvf -
    unzip ufsf_java_repos_flat_zips.zip
    unzip 50KC_flat.zip
    unzip 50KC_flat_zips.zip
    cat 50KC_flat_with_cloned_postmethod_zips.tar.gz.* | tar xzvf -
    unzip 50KC_flat_with_cloned_postmethod_zips.zip
    cat 50KC_flat_with_cloned_postmethod.tar.gz.* | tar xzvf - 
    unzip 50KC_flat_with_cloned_postmethod.zip
    cat SourcererCC-artifact.tar.gz.* | tar xzvf -
    unzip SourcererCC-artifact.zip

 
Generate the project list to be processed by SourcererCC. For 50KC_flat_zips. Make sure the paths in
project_list_generator_fromzips.py are set properly. "zips_path" should point to the directory containing
the zip files. Move the resulting projects list file to SourcererCC-artifact/tokenizers/block-level.

     python3 project_list_generator_fromzips.py

Generate the project list for the UFSF repositories. These should be under
ufsf_java_repos_flat/ufsf_java_repos_flat_zips. Make sure the "zips_path" points to where they are. Move
the resulting projects list file to SourcererCC-artifact/tokenizers/block-level.

     python3 project_list_generator_fromzips.py

Navigate to SourcererCC-artifact/tokenizers/block-level. Make sure the projects file pointing to the UFSF
repositories archives is named projects-list.txt.

    cp projects-list-ufsf.txt projects-list.txt.
    ./run_sourc.sh

Navigate to SourcererCC-artifact.

    mv sourc_results sourc_results_ufsf

Navigate to SourcererCC-artifact/tokenizers/block-level. Now make sure that the projects list file pointing
to the 50KC project archives is named projects-list.txt.

    rm projects-list.txt
    cp projects-list-50kc.txt projects-list.txt
    ./run_sourc.sh

Navigate to SourcererCC-artifact.

    mv sourc_results sourc_results_50kc

Navigate to the top level directory. In networkx_generator_atgks_inject_benign_dataset.py, make sure you set
the following paths (they must be absolute paths):

DICTIONARIES_PATH should point to the sourc_results_ufsf directory created before.

INJECTED_DATASET_PATH should point to an "astgks_clones" directory in the 50KC_flat_with_cloned_postmethod_zips
dataset. This directory need not exist beforehand.

UFSF_DATASET_PATH should point to the full version of the UFSF repositories dataset (not the directory
containing the zip archives of the repositories, but the repositories themselves). This should be under
ufsf_java_repos_flat/ufsf_java_repos_flat/.

KC50_DATASET_PATH should point to the full version of the 50KC dataset (again, not the directory containing the
zip archives).

 
    python3 networkx_generator_astgks_inject_benign_dataset.py

Navigate to 50KC_flat_with_cloned_postmethod_zips.

    zip -r astgks_clones.zip astgks_clones && rm -r astgks_clones

Navigate to the top level directory. Change the "zips_path" in project_list_generator_fromzips.py to point to
the  50KC_flat_with_cloned_postmethod_zips dataset.
 
    python3 project_list_generator_fromzips.py

Navigate to SourcererCC-artifact/tokenizers/block-level. Make sure that the projects list generated in the
previous step is named projects-list.txt.

    rm projects-list.txt
    mv projects-list-hybrid.txt projects-list.txt
    ./run_sourc.sh

Navigate to SourcererCC-artifact.
    
    mv sourc_results sourc_results_hybrid

Navigate to the top level directory.

In networkx_generator_astgks.py, make sure you set the following paths:

UFSF_DATASET_PATH, 50KC_DATASET_PATH and DICTIONARIES_PATH: the same as before for 
networkx_generator_astgks_inject_benign_dataset.py.

DICTIONARIES_PATH_50KC should point to the sourc_results_50kc directory created before.

DICTIONARIES_PATH_50KC_UFSF should point to the sourc_results_hybrid directory created before.

WHOLE_DATASET_PATH should point to the dataset directory containing astgks_clones.zip generated before.

    python3 networkx_generator_astgks.py

This will create a .gexf file with a code reuse graph. The file is by default named
"projects_java40_filtered_50kcfiltered_directed.gexf" and it's stored in 
SourcererCC-artifact/sourc_results_hybrid.
